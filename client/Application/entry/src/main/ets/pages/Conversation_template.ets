import http from '@ohos.net.http'
import hilog from '@ohos.hilog';

@Entry
@Component
struct Conversation {
  @State message: string = 'Hello World'
  @State dialogues: string[][] = [["暂无评论", "暂无回复"], ["暂无评论", "暂无回复"]]

  async aboutToAppear(){
    this.get_dialogues();
  }
  get_dialogues(){
    let httpDataRequest = http.createHttp();
    httpDataRequest.request(
      "http://[server-ip]/comments",
      {
        method: http.RequestMethod.GET,
        header: {
          "Content-Type": "application/json",
          "charset": "utf-8",
        },
        // extraData: {
        //   // 发送给服务器接口（API）的参数
        //   // BVID: ""
        // },
        connectTimeout: 60000,
        readTimeout: 60000
      },
      (err, data) => {
        if (err) {
          hilog.info(0x0000, 'testTag', '%{public}s', 'Request failed: ' + JSON.stringify(err));
          return;
        }
        var dialogueDataString = JSON.parse(data.result.toString());
        if (dialogueDataString) {
          this.dialogues = dialogueDataString.map(comment => [comment['content']['message'], comment['reply']]);
        }
      }
    )
  }
  /**
   * In low-code mode, do not add anything to the build function, as it will be
   * overwritten by the content generated by the .visual file in the build phase.
   */
  build() {
 
  }
}